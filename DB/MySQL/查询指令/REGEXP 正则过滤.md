## 简介

在`WHERE`子句中，虽然可以使用`LIKE`来做模糊匹配，但是有时候这种模糊匹配的到的结果还不够精确，此时就可以考虑使用`REGEXP`来进行匹配。

简单来说，正则表达式就是用来匹配文本的特殊字符串。比如，从文本中提取电话号码，带数字的用户名，或者提取某个特定格式的文本。


一般的正则过滤的语句格式为：

```mysql
SELECT * FROM table_name WHERE field_name REGEXP 'string';
```

## 使用

### 通配符

REGEXP 也可以使用通配符，不过和 LIKE 使用的通配符并不相同。REGEXP 更多的是遵循正则表达式的规则来进行的。

常用的通配符有如下示例：

* `.` 代表的任意字符。
* `^` 匹配字符串开头位置，如果用在`[]`的开头则表示排除`[]`中的字符。
* `$` 匹配字符串结尾位置。
* `[]` 匹配中括号中包含的字符。
* `|` 或，表示匹配改符号前面，或者后面的都可以。


### 匹配字符串

匹配字符串是正则表达式最基础的应用。

例子：从一个用户表中查询出名字中包含有`00`数字的用户。

```mysql
SELECT * FROM my_user WHERE `name` REGEXP '.00';
```

语句里的`.`就表示匹配任意一个字符。这个语句可以匹配的到 name 字段为'小红100'。而不能匹配到 name 字段为'00'的记录。

### 匹配字符集合

通过中括号将一系列的值包含进去，则表示包含这些字符的记录都会被匹配到。

```mysql
-- 表示匹配 name 字段包含数字(0 到 9)的记录
SELECT * FROM my_user WHERE `name` REGEXP '[0-9]';
-- 表示匹配 name 字段中不包含 1、2 字符的记录
SELECT * FROM my_user WHERE `name` REGEXP '[^12]';
```

### 或查询

通过`|`符号，可以指定多个匹配值进行匹配，而不需要使用`OR`。

```mysql
SELECT * FROM my_user WHERE `name` REGEXP '100|200';
```

这个语句表示匹配 name 字段为包含'100'或者'200'的记录。

### 匹配特殊字符

如果需要匹配正则中用到的特殊字符，比如`[`，那么就需要进行转义处理了。转义的时候需要连续使用双反斜线作为前导。

> 在一般的编程语言中，转义一般使用一个反斜线，在Mysql中为什么是两个才行？原因是：MySQL 自己需要一个来识别，然后 MySQL 会将扣除了一个反斜杠的剩余的部分完全的交给正则表达式库解释，所以加起来就是两个了。

常见的特殊字符转义如下：

```
\\[ 匹配左方括号
\\. 匹配点号
\\] 匹配右方括号
\\| 匹配竖线
\\\ 匹配反斜杠自己本身
```

双反斜杠加上一些字母还可以表示特殊的含义，比如：

```
\\f 换页
\\n 换行
\\r 回车
\\t 制表符
\\v 纵向制表符
```

### 预定义字符集

虽然正则表达式提供了一些很长表示方式的缩写，比如`[0-9]`表示数字。`[a-z]`表示小写字母。但是，有些时候还是觉得复杂。所以，正则表达式还提供了一些预定义的字符类来方便开发。

类         |   说明
---------- | --------------------------------------
[:alnum:]  | 任意数字和字母。相当于`[a-zA-Z0-9]`。
[:alpha:]  | 任意字符。相当于`[a-zA-z]`。
[:blank:]  | 空格和制表。相当于`[ \\t]`。
[:cntrl:]  | ASCII 控制字符（ASCII 0 到 31 和 127）
[:digit:]  | 任意数字。相当于`[0-9]`
[:graph:]  | 与 [:print:] 相同，但是不包含空格
[:lower:]  | 任意的小写字母。相当于`[a-z]`
[:print:]  | 任意可打印字符
[:punct:]  | 既不在 [:alnum:] 又不在 [:cntrl:] 中的任意字符
[:space:]  | 包括空格在内的任意空白字符。
[:upper:]  | 任意大写字母。相当于`[A-Z]`
[:xdigit:] | 任意十六进制的数字。相当于`[a-fA-F0-9]`

### 元字符

之前匹配的内容都是单词匹配。就是如果匹配到一次就显示，匹配不到就不显示。但是，复杂的情况有时候要求匹配不止一次。假设需要匹配名字中包含 2-3 位数字的记录。这个时候就需要使用一种特殊的元字符来修饰。

```mysql
SELECT * FROM my_user WHERE `name` REGEXP '[0-9]{2,3}';
```

常见的元字符如下：

元字符  | 作用
------ | --------------------
*      | 重复 0 次或者多次
+      | 重复一次或者多次。相当于 {1,}
?      | 重复 0 次或者 1 次
{n}    | 重复 n 次
{n,}   | 重复至少 n 次
{n,m}  | 重复 n-m 次

除了之前的重复元字符，正则还有一种特殊的定位元字符：

元字符   | 作用
------- | -------
^       | 文本开始
$       | 文本结尾
[[:<:]] | 词的开始
[[:>:]] | 词的结尾



