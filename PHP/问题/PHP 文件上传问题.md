### 问题

进行文件上传时，可能会出现稍大的文件无法上传的错误，有两种情况：

1. 返回 413 错误，提示 POST 请求体太长；
2. 无法获取到上传的文件及文件信息。

### 原因

这两种错误一般都是由于设置不当导致的，不仅仅是 PHP 相关的设置，可能还需要调整 Nginx 的设置(或其他 Web 服务器的设置)。

Nginx 和 PHP 都会有文件上传相关的限制，默认情况下，都比较小，如果需要上传较大的文件，那么就需要更改这些设置。

### 解决

首先，检查 Nginx 的`client_max_body_size`配置。默认情况下，Nginx 该指令的值为 2M，所以对于有上传大文件的情况，需要显式的更改配置。

```conf
client_max_body_size 20M;
```

> 该指令可以用于 Nginx 的 http、server 模块。

然后，需要配置 PHP 的配置文件`php.ini`，更改如下的几个指令：

```ini
; 是否允许通过 HTTP 上传文件的开关。默认为 ON 即是开 
file_uploads = on

; 文件上传至服务器上存储临时文件的地方，如果没指定就会用系统默认的临时文件夹
; 如果配置了，则需要确保 PHP 对该路径有读写操作
upload_tmp_dir = [path]

; 允许上传文件大小的最大值。默认为 2M，如要改成你期望的值
upload_max_filesize = 20M

; 指通过表单 POST 给 PHP 的所能接收的最大值，包括表单里的所有值。默认为 8M
; 如果没有修改这个值，那么上传大文件的时候，是不能获取到文件信息的
post_max_size = 20M
```

另外，上传较大的文件的时候，还需要考虑网络因素引起的 PHP 执行时间问题，否则可能会因为上传文件较长时间造成 PHP 运行超时，提前结束掉请求了。可以在`php.ini`中设置如下的几个配置：

```ini
; 每个 PHP 页面运行的最大时间值(秒)，默认 30 秒
; 不建议设置过大，否则会造成服务器负载过重
max_execution_time = 300

; 每个 PHP 页面接收数据所需的最大时间，默认 60 秒 
max_input_time = 600

; 每个 PHP 页面所吃掉的最大内存，默认 8M 
memory_limit = 8M
```

